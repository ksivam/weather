{
  "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "firewallRulesCount": {
      "type": "int"
    },
    "firewallRules": {
      "type": "array"
    },
    "databases": {
      "type": "array"
    },
    "databasesCount": {
      "type": "int"
    }
  },
  "variables": {},
  "resources": [
    {
      "name": "[concat(parameters('serverName'), '/', parameters('resourcePoolName'))]",
      "location": "[parameters('serverLocation')]",
      "type": "Microsoft.Sql/servers/resourcepools",
      "apiVersion": "2014-04-01-preview",
      "properties": {
        "databaseEdition": "[parameters('databaseEdition')]",
        "dtuGuarantee": "[parameters('dtuGuarantee')]",
        "databaseDtuGuarantee": "[parameters('databaseDtuGuarantee')]",
        "databaseDtuCap": "[parameters('databaseDtuCap')]",
        "storageLimitInGB": "[parameters('storageLimitInGB')]"
      }
    },
    {
      "dependsOn": [
         "[concat('Microsoft.Sql/servers/resourcepools', parameters('resourcePoolName'))]"
      ],
      "name": "[concat(parameters('serverName'), '/', parameters('databases')[copyIndex()].databaseName)]",
      "type": "Microsoft.Sql/servers/databases",
      "apiVersion": "2014-04-01-preview",
      "properties": {
        "resourcePoolName": "[parameters('resourcePoolName')]"
      },
      "copy": {
        "name": "addExistingDatabasesToResourcePool",
        "count": "[parameters('databasesCount')]"
      }
    }
  ]
}
